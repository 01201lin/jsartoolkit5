<html>
<body>

<script src="artk_demos/js/third_party/three.js/three.min.js"></script>
<script src="common.js"></script>

<video id="v" src="tests/output_4.ogg" width="320" height="240" loop="" controls="" autoplay webkit-playsinline></video>
<script>

artoolkit.init('../builds');

THREE.Matrix4.prototype.setFromArray = function(m) {
	return this.elements.set(m);
};

var renderer = new THREE.WebGLRenderer();
var scene = new THREE.Scene();

renderer.setSize(v.width, v.height);

document.body.appendChild(renderer.domElement);

// Create a camera and a marker root object for your Three.js scene.
var camera = new THREE.Camera();
scene.add(camera);

var light = new THREE.PointLight(0xffffff);
light.position.set(400, 500, 100);
scene.add(light);
var light = new THREE.PointLight(0xffffff);
light.position.set(-400, -500, -100);
scene.add(light);

var markerRoot = new THREE.Object3D();

markerRoot.matrixAutoUpdate = false;
camera.matrixAutoUpdate = false;

// Add the marker models and suchlike into your marker root object.

var cube = new THREE.Mesh(
  new THREE.CubeGeometry(1,1,1),
  new THREE.MeshLambertMaterial({ color: 0xffffff, wireframe: false })
);
cube.position.z = -10;
markerRoot.add(cube);

// Add the marker root to your scene.
scene.add(markerRoot);


artoolkit.onGetMarker = function(marker) {
	markerRoot.matrix.setFromArray(artoolkit.getTransformationMatrix());
};

// On every frame do the following:
function tick() {
	requestAnimationFrame(tick);

	var camera_mat = artoolkit.getCameraMatrix();
	if (!camera_mat) return;

	camera.projectionMatrix.setFromArray(camera_mat);
	camera.matrixWorld.identity();
	camera.matrix.identity();
	getFrame();

	// Render the scene.
	renderer.autoClear = false;
	renderer.clear();
	renderer.render(scene, camera);
}

tick();


artoolkit.onReady(function() {
	console.log('onready');
	var w = 320, h = 240;

	artoolkit.setup(w, h);
	artoolkit.debugSetup();

	interval = setInterval(getFrame, 13);
})

function getFrame() {
	artoolkit.process(v);
}

function stop() {
	clearInterval(interval)
}

</script>

</body>
</html>