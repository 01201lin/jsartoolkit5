<html>
<body>
<style>
canvas {
	transform: scale(-1, 1);
}
</style>

<script src="common.js"></script>
<script src="artk_demos/js/third_party/three.js/three.min.js"></script>
<script src="artk_demos/js/artoolkit.three.js"></script>
<video style="display:none;" id="video" src="tests/multi.mov" width="320" height="240" loop="" controls="" autoplay></video>

<script>


var markers = [];

artoolkit._eatthis = function(i) {
	// if (i == 8) console.log(artoolkit.getTransformationMatrix());
	markers[i].matrix.setFromArray(artoolkit.getTransformationMatrix());
}

artoolkit._eatMarkerRoot = function() {
	// console.log(artoolkit.getTransformationMatrix());
	markerRoot.matrix.setFromArray(artoolkit.getTransformationMatrix());
}


artoolkit.loadVideo = function(video, onSuccess) {

	artoolkit.init('../../builds', '../../bin/Data/camera_para.dat');


	artoolkit.onReady(function() {
		artoolkit.setup(video.width, video.height);
		artoolkit.debugSetup();

		var scenes = artoolkit.createThreeScene(video);
		onSuccess(scenes)
	})
}







artoolkit.loadVideo(video, function(arScene) {

window.scene = arScene.scene;

	var renderer = new THREE.WebGLRenderer({antialias: true});
	renderer.setSize(arScene.video.videoWidth, arScene.video.videoHeight);

	document.body.appendChild(renderer.domElement);

	// Create a couple of lights for our AR scene.
	var light = new THREE.PointLight(0xffffff);
	light.position.set(40, 40, 40);
	arScene.scene.add(light);

	var light = new THREE.PointLight(0xff8800);
	light.position.set(-40, -20, -30);
	arScene.scene.add(light);

	// Load the marker to use.
	artoolkit.loadMultiMarker('/bin/Data/multi-barcode-4x3.dat', function(marker) {

		// Create an object that tracks the marker transform.
		markerRoot = artoolkit.createThreeMultiMarker(999);
		arScene.scene.add(markerRoot);
		window.markerRoot = markerRoot;

		console.log('oomo')

		for (var i = 0; i < marker; i++) {
			var greenCube = new THREE.Mesh( new THREE.BoxGeometry(1,1,1), new THREE.MeshBasicMaterial({ color: 0xff0000, wireframe: true }) );

			markers.push(greenCube);
			// greenCube.position.z = 10.5;
			greenCube.visible = true;

			console.log(i);

			greenCube.matrixAutoUpdate = false;
			scene.add(greenCube);;
		}

			// greenCube.matrixAutoUpdate = false;

			var greenCube = new THREE.Mesh( new THREE.BoxGeometry(10,10,10), new THREE.MeshBasicMaterial({ color: 0xff0000, wireframe: true }) );

		window.greenCube = greenCube;
		markerRoot.add(greenCube);
		greenCube.position.z = 10.5;

		// markerRoot.position.z = -20;
		markerRoot.matrixAutoUpdate = false;

		// console.log('multi is', marker);

		var tick = function() {
			requestAnimationFrame(tick);
			arScene.process();
			arScene.renderOn(renderer);
		};
		tick();

	});

});

</script>

</body>
</html>