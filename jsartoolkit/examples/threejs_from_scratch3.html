<html>
<body>

<script src="js/third_party/three.js/three.min.js"></script>
<script src="../build/artoolkit.debug.js"></script>
<script src="../js/artoolkit.api.js"></script>

<video id="v" src="Data/output_4.ogg" width="320" height="240" loop="" controls="" autoplay webkit-playsinline></video>

<script>

var renderer = new THREE.WebGLRenderer();
var scene = new THREE.Scene();

var video = document.getElementById('v');

renderer.setSize(video.width, video.height);

document.body.appendChild(renderer.domElement);

var arController = null;

// Create a camera and a marker root object for your Three.js scene.
var camera = new THREE.Camera();
camera.matrixAutoUpdate = false;
scene.add(camera);


var cameraParam = new ARCameraParam();
cameraParam.onload = function() {

	arController = new ARController(320, 240, cameraParam);
	arController.debugSetup();

	var cameraMatrix = arController.getCameraMatrix();
	camera.projectionMatrix.elements.set(cameraMatrix);

};
cameraParam.load('Data/camera_para.dat');

var markerRoot = new THREE.Object3D();
markerRoot.markerMatrix = new Float64Array(12);
markerRoot.matrixAutoUpdate = false;
// Add the marker root to your scene.
scene.add(markerRoot);


// Add the marker models and suchlike into your marker root object.
var geometry = new THREE.BoxGeometry(1,1,1)
var material = new THREE.MeshNormalMaterial()
var mesh = new THREE.Mesh(geometry, material);
markerRoot.add(mesh);



anim();


//////////////////////////////////////////////////////////////////////////////////
//		Comments
//////////////////////////////////////////////////////////////////////////////////
// On every frame do the following:
function anim() {
	requestAnimationFrame(anim);

	if (!arController) return;

	arController.detectMarker(video);
	var markerNum = arController.getMarkerNum();
	if (markerNum > 0) {
		if (markerRoot.visible) {
			arController.getTransMatSquareCont(0, 1, markerRoot.markerMatrix, markerRoot.markerMatrix);
		} else {
			arController.getTransMatSquare(0 /* Marker index */, 1 /* Marker width */, markerRoot.markerMatrix);
		}
		markerRoot.visible = true;
		arController.transMatToGLMat(markerRoot.markerMatrix, markerRoot.matrix.elements);
	} else {
		markerRoot.visible = false;
	}

	arController.debugDraw();

	// Render the scene.
	renderer.render(scene, camera);
}


</script>

</body>
</html>
